<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="es" xml:lang="es" xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="exe_effects.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>2.2.3 Escenario 2. VPN Red Externa | UT11. Fortificación perimetral: VPN </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="content-language" content="es" />
<meta name="author" content="Juan Carlos Requena" />
<link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" />
<meta name="generator" content="eXeLearning 2.8 - exelearning.net" />
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="exe_effects.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="exe-web-site" id="exe-node-109"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Saltar la navegación</a></p>
<div id="header"  style="background-image: url(logo.png); background-repeat: no-repeat;"><div id="headerContent">UT11. Fortificación perimetral: VPN</div></div>
<div id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">UT11. Fortificación perimetral: VPN</a></li>
   <li><a href="objetivos.html" class="no-ch">Objetivos</a></li>
   <li><a href="1_introduccin_a_las_redes_privadas_virtuales_vpns.html" class="daddy">1. Introducción a las Redes privadas virtuales (VPNs)</a>
   <ul class="other-section">
      <li><a href="11_tneles_protocolo_vpn_ipsec.html" class="no-ch">1.1 Túneles (protocolo VPN IPSec)</a></li>
      <li><a href="12_tneles_protocolo_vpn_wireguard.html" class="no-ch">1.2 Túneles (protocolo VPN WireGuard)</a></li>
   </ul>
   </li>
   <li class="current-page-parent"><a href="2_vpn_de_acceso_remoto.html" class="current-page-parent daddy">2. VPN de acceso remoto</a>
   <ul>
      <li><a href="21_openvpn.html" class="no-ch">2.1 OpenVPN</a></li>
      <li class="current-page-parent"><a href="22_wireguard.html" class="current-page-parent daddy">2.2 WireGuard</a>
      <ul>
         <li><a href="221_instalacin_y_configuracin_de_wireguard.html" class="daddy">2.2.1 Instalación y configuración de WireGuard</a>
         <ul class="other-section">
            <li><a href="2211_configurar_un_cliente_mvil__red_externa.html" class="no-ch">2.2.1.1 Configurar un cliente móvil - Red Externa</a></li>
            <li><a href="2212_configurar_un_cliente_de_escritorio_red_interna.html" class="no-ch">2.2.1.2 Configurar un cliente de escritorio -Red Interna</a></li>
            <li><a href="2123_probando_la_conexin.html" class="no-ch">2.1.2.3 Probando la conexión</a></li>
         </ul>
         </li>
         <li><a href="222_escenario_1_vpn_red_interna.html" class="no-ch">2.2.2 Escenario 1. VPN Red Interna</a></li>
         <li id="active"><a href="223_escenario_2_vpn_red_externa.html" class="active no-ch">2.2.3 Escenario 2. VPN Red Externa</a></li>
         <li><a href="tarea_1_wireguardmikroticvlans.html" class="no-ch">Tarea 1. WireGuard-Mikrotic-VLANs</a></li>
         <li><a href="tarea_2_wireguard__pfsensemikrotik.html" class="no-ch">Tarea 2. WireGuard - PfSense-Mikrotik</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="3_gestin_de_accesos_sistemas_nac.html" class="daddy">3. Gestión de accesos. Sistemas NAC</a>
   <ul class="other-section">
      <li><a href="laboratorio_1_servidor_radius_vpn.html" class="daddy">Laboratorio 1. Servidor Radius VPN</a>
      <ul class="other-section">
         <li><a href="1_esquema_de_instalacin.html" class="no-ch">1. Esquema de Instalación</a></li>
         <li><a href="2_instalacinconfiguracin_servidorcliente_radius_en_windows_server_2019.html" class="no-ch">2. Instalación/Configuración Servidor/Cliente RADIUS en Windows Server 2019</a></li>
         <li><a href="3_pruebas_de_aaa_va_vpn.html" class="no-ch">3. Pruebas de AAA vía VPN</a></li>
      </ul>
      </li>
   </ul>
   </li>
</ul>
</div>
<div id='topPagination'>
<div class="pagination noprt">
<a href="222_escenario_1_vpn_red_interna.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="tarea_1_wireguardmikroticvlans.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</div>
</div>
<div id="main-wrapper">
<div id="main"><a name="main"></a>
<div id="nodeDecoration"><h1 id="nodeTitle">2.2.3 Escenario 2. VPN Red Externa</h1></div>
<div class="iDevice_wrapper textIdevice" id="id145">
<div class="iDevice emphasis0" >
<div id="ta145_145_2" class="block iDevice_content">
<div class="exe-text"><h3>1. Introducción</h3>
<p style="text-align: justify;">En este escenario, se pone en producción el servidor <strong>VPN WireGuard en ubuntu server</strong> para <strong>permitir</strong> <strong>conexiones VPN desde internet</strong>. De esta manera, se creará un túnel VPN de comunicación segura entre cada uno de los clientes (fuera de la red interna de la empresa) y el servidor.</p>
<p style="text-align: justify;"><span>Para implementar este escenario, es necesario que el servidor que se utilice tenga una IP pública. Como es poco habitual que esto ocurra en un entorno de aula, existe la opción de configurar un reenvío de puerto. Para ello, hay que <strong>configurar el router</strong> para que el <strong>puerto 15000</strong> sea redirigido al <strong>puerto 15000 de la IP local del servidor</strong> que para este caso es: <strong>192.168.0.254</strong>.</span></p>
<div class="cuadro-nota-centro-new">
<p style="text-align: justify;">También se puede hacer el escenario alquilando un servidor público para hacer la prueba. Por ejemplo, servicios en la nube como AWS y Azure ofrecen cuentas con créditos gratuitos para estudiantes.</p>
</div>
<p style="text-align: justify;">El dispositivo que se conectará a la <strong>VPN</strong> es un <strong>smartphone Iphone 6S</strong>. Una vez conectado el equipo, tendrá la capacidad de aprovechar los recursos disponibles en la red como cualquier otro equipo.</p>
<h3>2. Recursos necesarios y escenario</h3>
<ul>
<li>Servidor ubuntu server con Wireguard instalado.</li>
<li>Router con acceso a internet.</li>
<li>Smartphone Iphone 6s con WireGuard instalado.</li>
</ul>
<p>El esquema de red es el siguiente</p>
<p style="text-align: center;"><img src="Escenario2-RedExterna-Smartphone.png" alt="" width="774" height="386" /></p>
<h3>3. Preparar router WAN</h3>
<p style="text-align: justify;">En primer lugar, hay que configurar en el router del proveedor de internet una redirección de puerto para que las peticiones que se realicen a la ip pública en el puerto <strong>UDP</strong> <span><strong>15000</strong></span> las redirija a la ip/puerto 192.168.0.254:51820 del equipo ubuntu server.</p>
<p style="text-align: center;"><img src="redireccion-Puerto-15000-UDP.png" alt="" width="776" height="317" /></p>
<h3 style="text-align: justify;">4. Obtener la ip pública del router</h3>
<p style="text-align: justify;">Para la<strong> configuración de la conexión VPN en WireGuard del dispositivo</strong>, es necesario conocer la<strong> ip pública</strong> para incorporarla como Endpoint. Para saber la ip pública se tienen diferentes formas.</p>
<div class="exe-fx exe-tabs">
<h2><strong>1. Por comando</strong></h2>
<pre class="wp-block-preformatted"><span style="font-size: 12pt;"><strong>root@wireguard:/#</strong>curl ipinfo.io/ip</span></pre>
<p style="text-align: center;"><img src="curl-ipinfo.png" alt="" width="343" height="54" /></p>
<h2><strong>2. Por página web. </strong></h2>
<p>Accediendo por ejemplo a la url cualesmiip.com.</p>
<p style="text-align: center;"><img src="cualesmiip.png" alt="" width="743" height="397" /></p>
<h2>3. Desde el panel de administrador del router</h2>
<p style="text-align: center;"><a href="ip-WAN-router.png" target="_blank" rel="noopener"><img src="ip-WAN-router.png" alt="" width="455" height="360" /></a></p>
</div>
<p>Si se hace un traceroute a la ip WAN, el resultado que debe dar es de 1 salto.</p>
<pre class="wp-block-preformatted"><span style="font-size: 12pt;"><strong>root@wireguard:/#</strong>traceroute 100.70.155.204</span></pre>
<p style="text-align: center;"><img src="traceroute-ipWAN.png" alt="" width="701" height="83" /></p>
<h3>4. Conexión con smartphone Iphone 6S</h3>
<p style="text-align: justify;">En primer lugar hay que crear el túnel VPN en el dispositivo tal como se describe en el capítulo 2.2.1.1. A continuación, si todo ha ido bien, en el servidor ya se podría ver la conexión establecida.</p>
<p style="text-align: center;"><img src="wg-VPN-Externa.png" alt="" width="557" height="269" /></p></div>
</div>
</div>
</div>
<div id="packageLicense" class="cc cc-by-nc-sa">
<p><span>Obra publicada con</span> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Licencia Creative Commons Reconocimiento No comercial Compartir igual 4.0</a></p>
</div>
</div>
</div>
<div id='bottomPagination'>
<div class="pagination noprt">
<a href="222_escenario_1_vpn_red_interna.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="tarea_1_wireguardmikroticvlans.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</div>
</div>
</div>
<p id="made-with-eXe"><a href="https://exelearning.net/" target="_blank" rel="noopener"><span>Creado con eXeLearning<span> (Ventana nueva)</span></span></a></p><script type="text/javascript" src="_style_js.js"></script></body></html>