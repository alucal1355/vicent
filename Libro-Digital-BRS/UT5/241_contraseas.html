<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="es" xml:lang="es" xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>2.4.1 Contraseñas | UT5. Fortificación de equipos: Configuración de los sistemas informáticos </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="content-language" content="es" />
<meta name="author" content="Juan Carlos Requena" />
<link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" />
<meta name="generator" content="eXeLearning 2.7 - exelearning.net" />
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="exe-web-site" id="exe-node-49"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Saltar la navegación</a></p>
<div id="header"  style="background-image: url(logoJCRequena.png); background-repeat: no-repeat;"><div id="headerContent">UT5. Fortificación de equipos: Configuración de los sistemas informáticos</div></div>
<div id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">UT5. Fortificación de equipos: Configuración de los sistemas informáticos</a></li>
   <li><a href="objetivos.html" class="no-ch">Objetivos</a></li>
   <li class="current-page-parent"><a href="2_hardening.html" class="current-page-parent daddy">2. Hardening</a>
   <ul>
      <li><a href="21_server_hardening.html" class="no-ch">2.1 Server Hardening</a></li>
      <li><a href="22_recomendaciones_generales_de_seguridad_en_servidores.html" class="no-ch">2.2 Recomendaciones generales de seguridad en servidores</a></li>
      <li><a href="23_defensa_en_profundidad.html" class="no-ch">2.3 Defensa en profundidad</a></li>
      <li><a href="24_hardening_windows.html" class="daddy">2.4 Hardening Windows</a>
      <ul class="other-section">
         <li><a href="241_windows_exploit_suggester.html" class="daddy">2.4.1 Windows Exploit Suggester</a>
         <ul class="other-section">
            <li><a href="proyecto_server_hardening_windows__realizar_una_auditora_en_el_servidor_windows.html" class="no-ch">Proyecto Server Hardening Windows - Realizar una auditoría en el servidor Windows</a></li>
         </ul>
         </li>
         <li><a href="242_reduccin_del_nmero_de_servicios.html" class="daddy">2.4.2 Reducción del número de servicios</a>
         <ul class="other-section">
            <li><a href="laboratorio_1_process_hacker.html" class="no-ch">Laboratorio 1. Process Hacker</a></li>
            <li><a href="laboratorio_2_uso_del_firewall_de_windows__configuracin_de_red.html" class="no-ch">Laboratorio 2. Uso del firewall de Windows - Configuración de red</a></li>
            <li><a href="proyecto_server_hardening_windows__seguridad_de_red_y_firewall.html" class="no-ch">Proyecto Server Hardening Windows - Seguridad de red y firewall</a></li>
         </ul>
         </li>
      </ul>
      </li>
      <li class="current-page-parent"><a href="25_hardening_linux__lynis.html" class="current-page-parent daddy">2.5 Hardening Linux - Lynis</a>
      <ul>
         <li><a href="proyecto_server_hardening_linux_auditora_de_sistemas_con_lynis.html" class="no-ch">Proyecto Server Hardening Linux. Auditoría de sistemas con Lynis</a></li>
         <li id="active"><a href="241_contraseas.html" class="active no-ch">2.4.1 Contraseñas</a></li>
         <li><a href="242_configuracin_de_red.html" class="no-ch">2.4.2 Configuración de red</a></li>
         <li><a href="243_cortafuegos_basados_en_host__configuracin_del_firewall_ufw.html" class="no-ch">2.4.3 Cortafuegos basados en host - Configuración del firewall ufw</a></li>
         <li><a href="laboratorio_3_uso_del_firewall_de_linux__iptables.html" class="no-ch">Laboratorio 3. Uso del firewall de Linux - Iptables</a></li>
         <li><a href="proyecto_server_hardening_linux_contraseas_red_y_firewall.html" class="no-ch">Proyecto Server Hardening Linux. Contraseñas, red y firewall</a></li>
      </ul>
      </li>
      <li><a href="26_hardening_apache.html" class="daddy">2.6 Hardening Apache</a>
      <ul class="other-section">
         <li><a href="proyecto_server_hardening_linux_apache.html" class="no-ch">Proyecto Server Hardening Linux. Apache</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="3_securizacin_de_los_sistemas_de_administracin_remota.html" class="daddy">3. Securización de los sistemas de administración remota</a>
   <ul class="other-section">
      <li><a href="31_secureshell.html" class="daddy">3.1 SecureShell</a>
      <ul class="other-section">
         <li><a href="311_aplicaciones_de_ssh.html" class="no-ch">3.1.1 Aplicaciones de SSH</a></li>
         <li><a href="312_instalacin_del_servidor_ssh.html" class="no-ch">3.1.2 Instalación del servidor SSH</a></li>
         <li><a href="313_secure_shell_para_administracin_remota_mediante_certificado.html" class="daddy">3.1.3 Secure Shell para administración remota mediante certificado</a>
         <ul class="other-section">
            <li><a href="tarea_1_ssh__acceso_remoto_desde_windows_10.html" class="no-ch">Tarea 1. SSH - Acceso remoto desde Windows 10</a></li>
         </ul>
         </li>
         <li><a href="314_anlisis_de_archivos_de_auditora.html" class="daddy">3.1.4 Análisis de archivos de auditoría</a>
         <ul class="other-section">
            <li><a href="laboratorio_4_instalacin_de_graylog.html" class="no-ch">Laboratorio 4. Instalación de Graylog</a></li>
         </ul>
         </li>
         <li><a href="315_fortificacin_de_ssh.html" class="no-ch">3.1.5 Fortificación de SSH</a></li>
         <li><a href="proyecto_server_hardening_linux_34_caso_prctico_fortificacin_ssh.html" class="no-ch">Proyecto Server Hardening Linux. 3.4 Caso práctico fortificación ssh</a></li>
         <li><a href="316_sshguard.html" class="daddy">3.1.6 SSHGuard</a>
         <ul class="other-section">
            <li><a href="proyecto_server_hardening_linux_sshguard.html" class="no-ch">Proyecto Server Hardening Linux. SSHGuard</a></li>
         </ul>
         </li>
      </ul>
      </li>
      <li><a href="32__rdpguard.html" class="daddy">3.2  RdpGuard</a>
      <ul class="other-section">
         <li><a href="proyecto_server_hardening_windows_rdpguard.html" class="no-ch">Proyecto Server Hardening Windows. RdpGuard</a></li>
      </ul>
      </li>
      <li><a href="33_fail2ban.html" class="daddy">3.3 Fail2Ban</a>
      <ul class="other-section">
         <li><a href="proyecto_server_hardening_linux__fail2ban.html" class="no-ch">Proyecto Server Hardening Linux - Fail2ban</a></li>
      </ul>
      </li>
      <li><a href="34_fwsnort.html" class="no-ch">3.4 Fwsnort</a></li>
      <li><a href="35_grsecurity.html" class="no-ch">3.5 Grsecurity</a></li>
   </ul>
   </li>
   <li><a href="4_sistemas_de_prevencin_y_proteccin_frente_a_virus_e_intrusiones.html" class="daddy">4. Sistemas de prevención y protección frente a virus e intrusiones</a>
   <ul class="other-section">
      <li><a href="41_antivirus.html" class="daddy">4.1. Antivirus</a>
      <ul class="other-section">
         <li><a href="411_virustotal.html" class="no-ch">4.1.1 VirusTotal</a></li>
      </ul>
      </li>
      <li><a href="42_antivirus_endpoint_detection__response_edr.html" class="daddy">4.2. Antivirus Endpoint Detection &amp; Response (EDR)</a>
      <ul class="other-section">
         <li><a href="421_ejemplo_de_una_solucin_antivirus_en_la_nube.html" class="daddy">4.2.1 Ejemplo de una solución antivirus en la nube</a>
         <ul class="other-section">
            <li><a href="4211_registro_y_creacin_del_espacio_de_trabajo.html" class="no-ch">4.2.1.1 Registro y creación del espacio de trabajo</a></li>
            <li><a href="4212_panel_de_informacin_configuracin_primeros_pasos.html" class="no-ch">4.2.1.2 Panel de Información. Configuración. Primeros pasos</a></li>
            <li><a href="4213_usuarios.html" class="no-ch">4.2.1.3 Usuarios</a></li>
            <li><a href="4214_dispositivos.html" class="no-ch">4.2.1.4 Dispositivos</a></li>
            <li><a href="4215_administrador_de_seguridad.html" class="no-ch">4.2.1.5 Administrador de Seguridad</a></li>
            <li><a href="4216_vulnerabilidades_parches_cifrado_y_certificados.html" class="no-ch">4.2.1.6 Vulnerabilidades, parches, cifrado y certificados</a></li>
            <li><a href="4217_nuevas_funcionalidades.html" class="no-ch">4.2.1.7 Nuevas funcionalidades</a></li>
            <li><a href="proyecto_server_hardening_windows_kaspersky.html" class="no-ch">Proyecto Server Hardening Windows. Kaspersky</a></li>
         </ul>
         </li>
      </ul>
      </li>
      <li><a href="43_host_ids.html" class="daddy">4.3. Host IDS</a>
      <ul class="other-section">
         <li><a href="proyecto_server_hardening_windows__ids_wazuh.html" class="no-ch">Proyecto Server Hardening Windows - IDS wazuh</a></li>
      </ul>
      </li>
      <li><a href="44_honeypot.html" class="no-ch">4.4. Honeypot</a></li>
   </ul>
   </li>
   <li><a href="5_configuracin_de_actualizaciones_y_parches_automticos.html" class="daddy">5. Configuración de actualizaciones y parches automáticos</a>
   <ul class="other-section">
      <li><a href="51_unattendedupgrades.html" class="no-ch">5.1 unattended-upgrades</a></li>
      <li><a href="52_wsus.html" class="daddy">5.2 WSUS</a>
      <ul class="other-section">
         <li><a href="faqserroreswsus.html" class="no-ch">FAQS-errores-WSUS</a></li>
         <li><a href="proyecto_server_hardening_windows_wsus.html" class="no-ch">Proyecto Server Hardening Windows. WSUS</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="6_sistemas_de_copias_de_seguridad.html" class="daddy">6. Sistemas de copias de seguridad</a>
   <ul class="other-section">
      <li><a href="61_herramientas.html" class="no-ch">6.1 Herramientas</a></li>
      <li><a href="62_copias_a_disco_duro.html" class="no-ch">6.2 Copias a disco duro</a></li>
      <li><a href="63_copias_a_unidad_en_drive.html" class="no-ch">6.3 Copias a unidad en Drive</a></li>
      <li><a href="64_gestin_de_backups_en_linux.html" class="no-ch">6.4 Gestión de backups en Linux</a></li>
      <li><a href="proyecto_server_hardening_en_linux_y_windows__copias_de_seguridad.html" class="no-ch">Proyecto Server Hardening en Linux y Windows - Copias de Seguridad</a></li>
   </ul>
   </li>
   <li><a href="7_soluciones_dlp.html" class="daddy">7. Soluciones DLP</a>
   <ul class="other-section">
      <li><a href="71_plataformas_dlp_en_el_mercado.html" class="no-ch">7.1 Plataformas DLP en el mercado</a></li>
   </ul>
   </li>
   <li><a href="8_referencias.html" class="no-ch">8. Referencias</a></li>
</ul>
</div>
<div id='topPagination'>
<div class="pagination noprt">
<a href="proyecto_server_hardening_linux_auditora_de_sistemas_con_lynis.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="242_configuracin_de_red.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</div>
</div>
<div id="main-wrapper">
<div id="main"><a name="main"></a>
<div id="nodeDecoration"><h1 id="nodeTitle">2.4.1 Contraseñas</h1></div>
<div class="iDevice_wrapper FreeTextIdevice" id="id84">
<div class="iDevice emphasis0">
<div id="ta84_85" class="block iDevice_content">
<h3>1. Establecer una contraseña de arranque</h3>
<p style="text-align: justify;">En la UT4, se estudió cómo <span style="font-size: 1em;">establecer una contraseña en el grub. </span>Para ello se utilizó el comando <strong>grub-mkpasswd-pbkdf2 </strong>, el cual genera un hash de una contraseña dada y, así, evitar que se puedan obtener fácilmente.</p>
<p>Una vez establecida la contraseña, hay que editar el fichero <strong>00_header</strong><span> que se encuentra en <strong>/etc/grub.d/ </strong></span><strong>con</strong> los siguientes datos al final:</p>
<pre><span style="font-size: 12pt;">cat &lt;&lt;EOF</span><br /><span style="font-size: 12pt;">set superusers=”administrador”</span><br /><span style="font-size: 12pt;">password_pbkdf2 administrador <strong>&lt;</strong>salida del comando grub-mkpasswd-pbkdf2<strong>&gt;<br /></strong>EOF<strong><br /></strong></span></pre>
<p>Para consolidar los cambios, hay que actualizar grub2.</p>
<h3>2. Configuración de contraseñas seguras</h3>
<p>En la UT4, se estudió cómo <span style="font-size: 1em;">establecer contraseñas seguras. </span>Para ello se utilizó la herramienta <strong>libpam-pwquality </strong>y el fichero<strong>/etc/login.defs, </strong>donde se establecían las políticas a aplicar en la organización.</p>
<h3>3. Configuración de entorno</h3>
<p style="text-align: justify;">En un servidor es importante establecer que aquellas cuentas que no se utilicen en determinado tiempo sean bloqueadas, de esta manera se evita disponer de cuentas olvidadas con privilegios en el servidor. Para ello, el comando que permite implementar el bloqueo es <strong>useradd</strong>.</p>
<p style="text-align: justify;"><strong>Ejemplo:</strong> Si se quieren bloquear las cuentas que no se hayan utilizado pasados 31 dìas, el comando es:</p>
<pre><span style="font-size: 12pt;"><strong>administrador@orion:~$ </strong>sudo useradd -D -f 30</span></pre>
<p style="text-align: justify;">Para aplicarlo sobre un usuario en concreto. Ejemplo: Si se desea bloquear la cuenta del usuario jcrequena después de 31 días sin utilizarse, el comando es:</p>
<pre><span style="font-size: 12pt;"><strong>administrador@orion:~$ </strong>sudo chage --inactive 31 jcrequena</span></pre>
<h4 style="text-align: justify;">Bloqueo de la consola</h4>
<p style="text-align: justify;">Para establecer el tiempo de timeout, es decir, el tiempo en el que la consola se encontrará operativa hasta que lleve un determinado tiempo sin introducir comandos, momento en el cual se bloqueará, hay que modificar el fichero <strong>bash.bashrc </strong>que se encuentra en<strong> /etc, para añadir </strong>al final las siguientes líneas:</p>
<ul>
<li style="text-align: justify;">readonly TMOUT=300; Este dato se expresa en segundos. Como ejemplo se desea el bloqueo pasado 5 minutos sin recibir comandos en la consola (60x5)</li>
<li style="text-align: justify;">export TMOUT</li>
</ul>
<pre><span style="font-size: 12pt;"><strong>administrador@orion:~$ </strong>sudo nano /etc/bash.bashrc </span></pre>
<p style="text-align: center;"><img src="timeot-consola.png" alt="" width="797" height="600" /></p>
<h3>4. Bloqueos de inicio de sesión</h3>
<p style="text-align: justify;">En ocasiones pueden intentarse accesos por fuerza bruta a un sistema, para evitarlo se tiene disponible el paquete <strong>fail2ban</strong> con el cual se pueden bloquear los intentos de acceso baneando la IP que los realiza. En primer lugar, hay que descargar el paquete para su instalación.</p>
<pre><span style="font-size: 12pt;"><strong>administrador@orion:~$ </strong>sudo apt install fail2ban</span></pre>
<p style="text-align: center;"><img src="install-fail2ban.png" alt="" width="655" height="247" /></p>
<p>Una vez instalado, se crean los archivos de configuración en la ruta<span> </span><strong>/etc/fail2ban. </strong>En esta misma carpeta, hay que modificar ciertos archivos.</p>
<p>El primero,<span> </span><strong>jail.conf</strong>, no se modificará directamente si no que se realiza una copia del mismo:</p>
<pre><span style="font-size: 12pt;"><strong>administrador@orion:~$ </strong>sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local</span></pre>
<p>A continuación, hay que modificar el fichero <span style="font-size: 12pt;">jail.local.</span></p>
<pre><span style="font-size: 12pt;"><strong>administrador@orion:~$ </strong>sudo nano /etc/fail2ban/jail.local</span></pre>
<p><span>Al comienzo, en la sección de <strong>[DEFAULT]</strong> se tiene lo siguiente:</span></p>
<p style="text-align: center;"><span><img src="jail.local-01.png" alt="" width="641" height="358" /></span></p>
<p style="text-align: justify;"><span>donde,</span></p>
<ul>
<li><strong>Bantime</strong><span> </span>es el tiempo que un host será bloqueado del servidor en caso de baneo.</li>
<li><strong>maxretry</strong><span> </span>es el número de intentos fallidos realizados por una IP para que sea baneada.</li>
<li><strong>findtime</strong><span> </span>es el tiempo en el que deben ocurrir los intentos especificados en maxretry para que la  cuenta sea baneada.</li>
</ul>
<p>Hay que ir hasta la sección de <strong>[sshd]</strong></p>
<p style="text-align: center;"><img src="jail-local-02.png" alt="" width="643" height="250" /></p>
<p>y añadir lo siguiente:</p>
<ul>
<li><span style="color: #333300;">enabled = true</span></li>
<li><span style="color: #333300;">filter = sshd</span></li>
</ul>
<p>De esta manera, se ha habilitado la jaula de SSH y especificado el filtro a utilizar, en este caso el filtro encontrado en:<span> </span><strong>/etc/fail2ban/filter.d/sshd.conf</strong></p>
<p>Además, se añade la siguiente línea:</p>
<ul>
<li><span style="color: #333300;">banaction = iptables-multiport</span></li>
</ul>
<p>Con esto se define la acción que se realizará para banear las IP's, en este caso, iptables.</p>
<p>La directiva quedará asi:</p>
<p style="text-align: center;"><img src="jail-local-03.png" alt="" width="643" height="407" /></p>
<p style="text-align: justify;"><span></span>Para consolidar los cambios, hay que reiniciar el servicio:</p>
<pre><span style="font-size: 12pt;"><strong>administrador@orion:~$ </strong>sudo service fail2ban restart</span></pre>
<p style="text-align: justify;"><span>Con esto ya se tendría configurado <strong>fail2ban</strong>. Ahora, si alguien falla 5 veces la conexión, en menos de 10 minutos, será baneado 10 minutos mediante iptables. Los tiempos son los que ya estaban configurados por defecto en la sección [DEFAULT]:</span></p>
<p style="text-align: center;"><span><img src="jai-local-04.png" alt="" width="650" height="407" /></span></p>
</div>
</div>
</div>
<div id="packageLicense" class="cc cc-by-nc-sa">
<p><span>Obra publicada con</span> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Licencia Creative Commons Reconocimiento No comercial Compartir igual 4.0</a></p>
</div>
</div>
</div>
<div id='bottomPagination'>
<div class="pagination noprt">
<a href="proyecto_server_hardening_linux_auditora_de_sistemas_con_lynis.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="242_configuracin_de_red.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</div>
</div>
</div>
<script type="text/javascript" src="_style_js.js"></script></body></html>