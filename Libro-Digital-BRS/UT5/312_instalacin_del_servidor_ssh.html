<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="es" xml:lang="es" xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>3.1.2 Instalación del servidor SSH | UT5. Fortificación de equipos: Configuración de los sistemas informáticos </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="content-language" content="es" />
<meta name="author" content="Juan Carlos Requena" />
<link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" />
<meta name="generator" content="eXeLearning 2.7 - exelearning.net" />
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="exe-web-site" id="exe-node-64"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Saltar la navegación</a></p>
<div id="header"  style="background-image: url(logoJCRequena.png); background-repeat: no-repeat;"><div id="headerContent">UT5. Fortificación de equipos: Configuración de los sistemas informáticos</div></div>
<div id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">UT5. Fortificación de equipos: Configuración de los sistemas informáticos</a></li>
   <li><a href="objetivos.html" class="no-ch">Objetivos</a></li>
   <li><a href="2_hardening.html" class="daddy">2. Hardening</a>
   <ul class="other-section">
      <li><a href="21_server_hardening.html" class="no-ch">2.1 Server Hardening</a></li>
      <li><a href="22_recomendaciones_generales_de_seguridad_en_servidores.html" class="no-ch">2.2 Recomendaciones generales de seguridad en servidores</a></li>
      <li><a href="23_defensa_en_profundidad.html" class="no-ch">2.3 Defensa en profundidad</a></li>
      <li><a href="24_hardening_windows.html" class="daddy">2.4 Hardening Windows</a>
      <ul class="other-section">
         <li><a href="241_windows_exploit_suggester.html" class="daddy">2.4.1 Windows Exploit Suggester</a>
         <ul class="other-section">
            <li><a href="proyecto_server_hardening_windows__realizar_una_auditora_en_el_servidor_windows.html" class="no-ch">Proyecto Server Hardening Windows - Realizar una auditoría en el servidor Windows</a></li>
         </ul>
         </li>
         <li><a href="242_reduccin_del_nmero_de_servicios.html" class="daddy">2.4.2 Reducción del número de servicios</a>
         <ul class="other-section">
            <li><a href="laboratorio_1_process_hacker.html" class="no-ch">Laboratorio 1. Process Hacker</a></li>
            <li><a href="laboratorio_2_uso_del_firewall_de_windows__configuracin_de_red.html" class="no-ch">Laboratorio 2. Uso del firewall de Windows - Configuración de red</a></li>
            <li><a href="proyecto_server_hardening_windows__seguridad_de_red_y_firewall.html" class="no-ch">Proyecto Server Hardening Windows - Seguridad de red y firewall</a></li>
         </ul>
         </li>
      </ul>
      </li>
      <li><a href="25_hardening_linux__lynis.html" class="daddy">2.5 Hardening Linux - Lynis</a>
      <ul class="other-section">
         <li><a href="proyecto_server_hardening_linux_auditora_de_sistemas_con_lynis.html" class="no-ch">Proyecto Server Hardening Linux. Auditoría de sistemas con Lynis</a></li>
         <li><a href="241_contraseas.html" class="no-ch">2.4.1 Contraseñas</a></li>
         <li><a href="242_configuracin_de_red.html" class="no-ch">2.4.2 Configuración de red</a></li>
         <li><a href="243_cortafuegos_basados_en_host__configuracin_del_firewall_ufw.html" class="no-ch">2.4.3 Cortafuegos basados en host - Configuración del firewall ufw</a></li>
         <li><a href="laboratorio_3_uso_del_firewall_de_linux__iptables.html" class="no-ch">Laboratorio 3. Uso del firewall de Linux - Iptables</a></li>
         <li><a href="proyecto_server_hardening_linux_contraseas_red_y_firewall.html" class="no-ch">Proyecto Server Hardening Linux. Contraseñas, red y firewall</a></li>
      </ul>
      </li>
      <li><a href="26_hardening_apache.html" class="daddy">2.6 Hardening Apache</a>
      <ul class="other-section">
         <li><a href="proyecto_server_hardening_linux_apache.html" class="no-ch">Proyecto Server Hardening Linux. Apache</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li class="current-page-parent"><a href="3_securizacin_de_los_sistemas_de_administracin_remota.html" class="current-page-parent daddy">3. Securización de los sistemas de administración remota</a>
   <ul>
      <li class="current-page-parent"><a href="31_secureshell.html" class="current-page-parent daddy">3.1 SecureShell</a>
      <ul>
         <li><a href="311_aplicaciones_de_ssh.html" class="no-ch">3.1.1 Aplicaciones de SSH</a></li>
         <li id="active"><a href="312_instalacin_del_servidor_ssh.html" class="active no-ch">3.1.2 Instalación del servidor SSH</a></li>
         <li><a href="313_secure_shell_para_administracin_remota_mediante_certificado.html" class="daddy">3.1.3 Secure Shell para administración remota mediante certificado</a>
         <ul class="other-section">
            <li><a href="tarea_1_ssh__acceso_remoto_desde_windows_10.html" class="no-ch">Tarea 1. SSH - Acceso remoto desde Windows 10</a></li>
         </ul>
         </li>
         <li><a href="314_anlisis_de_archivos_de_auditora.html" class="daddy">3.1.4 Análisis de archivos de auditoría</a>
         <ul class="other-section">
            <li><a href="laboratorio_4_instalacin_de_graylog.html" class="no-ch">Laboratorio 4. Instalación de Graylog</a></li>
         </ul>
         </li>
         <li><a href="315_fortificacin_de_ssh.html" class="no-ch">3.1.5 Fortificación de SSH</a></li>
         <li><a href="proyecto_server_hardening_linux_34_caso_prctico_fortificacin_ssh.html" class="no-ch">Proyecto Server Hardening Linux. 3.4 Caso práctico fortificación ssh</a></li>
         <li><a href="316_sshguard.html" class="daddy">3.1.6 SSHGuard</a>
         <ul class="other-section">
            <li><a href="proyecto_server_hardening_linux_sshguard.html" class="no-ch">Proyecto Server Hardening Linux. SSHGuard</a></li>
         </ul>
         </li>
      </ul>
      </li>
      <li><a href="32__rdpguard.html" class="daddy">3.2  RdpGuard</a>
      <ul class="other-section">
         <li><a href="proyecto_server_hardening_windows_rdpguard.html" class="no-ch">Proyecto Server Hardening Windows. RdpGuard</a></li>
      </ul>
      </li>
      <li><a href="33_fail2ban.html" class="daddy">3.3 Fail2Ban</a>
      <ul class="other-section">
         <li><a href="proyecto_server_hardening_linux__fail2ban.html" class="no-ch">Proyecto Server Hardening Linux - Fail2ban</a></li>
      </ul>
      </li>
      <li><a href="34_fwsnort.html" class="no-ch">3.4 Fwsnort</a></li>
      <li><a href="35_grsecurity.html" class="no-ch">3.5 Grsecurity</a></li>
   </ul>
   </li>
   <li><a href="4_sistemas_de_prevencin_y_proteccin_frente_a_virus_e_intrusiones.html" class="daddy">4. Sistemas de prevención y protección frente a virus e intrusiones</a>
   <ul class="other-section">
      <li><a href="41_antivirus.html" class="daddy">4.1. Antivirus</a>
      <ul class="other-section">
         <li><a href="411_virustotal.html" class="no-ch">4.1.1 VirusTotal</a></li>
      </ul>
      </li>
      <li><a href="42_antivirus_endpoint_detection__response_edr.html" class="daddy">4.2. Antivirus Endpoint Detection &amp; Response (EDR)</a>
      <ul class="other-section">
         <li><a href="421_ejemplo_de_una_solucin_antivirus_en_la_nube.html" class="daddy">4.2.1 Ejemplo de una solución antivirus en la nube</a>
         <ul class="other-section">
            <li><a href="4211_registro_y_creacin_del_espacio_de_trabajo.html" class="no-ch">4.2.1.1 Registro y creación del espacio de trabajo</a></li>
            <li><a href="4212_panel_de_informacin_configuracin_primeros_pasos.html" class="no-ch">4.2.1.2 Panel de Información. Configuración. Primeros pasos</a></li>
            <li><a href="4213_usuarios.html" class="no-ch">4.2.1.3 Usuarios</a></li>
            <li><a href="4214_dispositivos.html" class="no-ch">4.2.1.4 Dispositivos</a></li>
            <li><a href="4215_administrador_de_seguridad.html" class="no-ch">4.2.1.5 Administrador de Seguridad</a></li>
            <li><a href="4216_vulnerabilidades_parches_cifrado_y_certificados.html" class="no-ch">4.2.1.6 Vulnerabilidades, parches, cifrado y certificados</a></li>
            <li><a href="4217_nuevas_funcionalidades.html" class="no-ch">4.2.1.7 Nuevas funcionalidades</a></li>
            <li><a href="proyecto_server_hardening_windows_kaspersky.html" class="no-ch">Proyecto Server Hardening Windows. Kaspersky</a></li>
         </ul>
         </li>
      </ul>
      </li>
      <li><a href="43_host_ids.html" class="daddy">4.3. Host IDS</a>
      <ul class="other-section">
         <li><a href="proyecto_server_hardening_windows__ids_wazuh.html" class="no-ch">Proyecto Server Hardening Windows - IDS wazuh</a></li>
      </ul>
      </li>
      <li><a href="44_honeypot.html" class="no-ch">4.4. Honeypot</a></li>
   </ul>
   </li>
   <li><a href="5_configuracin_de_actualizaciones_y_parches_automticos.html" class="daddy">5. Configuración de actualizaciones y parches automáticos</a>
   <ul class="other-section">
      <li><a href="51_unattendedupgrades.html" class="no-ch">5.1 unattended-upgrades</a></li>
      <li><a href="52_wsus.html" class="daddy">5.2 WSUS</a>
      <ul class="other-section">
         <li><a href="faqserroreswsus.html" class="no-ch">FAQS-errores-WSUS</a></li>
         <li><a href="proyecto_server_hardening_windows_wsus.html" class="no-ch">Proyecto Server Hardening Windows. WSUS</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li><a href="6_sistemas_de_copias_de_seguridad.html" class="daddy">6. Sistemas de copias de seguridad</a>
   <ul class="other-section">
      <li><a href="61_herramientas.html" class="no-ch">6.1 Herramientas</a></li>
      <li><a href="62_copias_a_disco_duro.html" class="no-ch">6.2 Copias a disco duro</a></li>
      <li><a href="63_copias_a_unidad_en_drive.html" class="no-ch">6.3 Copias a unidad en Drive</a></li>
      <li><a href="64_gestin_de_backups_en_linux.html" class="no-ch">6.4 Gestión de backups en Linux</a></li>
      <li><a href="proyecto_server_hardening_en_linux_y_windows__copias_de_seguridad.html" class="no-ch">Proyecto Server Hardening en Linux y Windows - Copias de Seguridad</a></li>
   </ul>
   </li>
   <li><a href="7_soluciones_dlp.html" class="daddy">7. Soluciones DLP</a>
   <ul class="other-section">
      <li><a href="71_plataformas_dlp_en_el_mercado.html" class="no-ch">7.1 Plataformas DLP en el mercado</a></li>
   </ul>
   </li>
   <li><a href="8_referencias.html" class="no-ch">8. Referencias</a></li>
</ul>
</div>
<div id='topPagination'>
<div class="pagination noprt">
<a href="311_aplicaciones_de_ssh.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="313_secure_shell_para_administracin_remota_mediante_certificado.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</div>
</div>
<div id="main-wrapper">
<div id="main"><a name="main"></a>
<div id="nodeDecoration"><h1 id="nodeTitle">3.1.2 Instalación del servidor SSH</h1></div>
<div class="iDevice_wrapper FreeTextIdevice" id="id95">
<div class="iDevice emphasis0">
<div id="ta95_85" class="block iDevice_content">
<h3>1. Introducción</h3>
<p style="text-align: justify;"><strong>SSH</strong> (Secure Shell) es un protocolo de red que utiliza técnicas criptográficas para proporcionar un canal de comunicación seguro sobre una red no segura en una arquitectura cliente-sevidor. El puerto TCP asignado al servicio SSH es el <strong>22</strong>.</p>
<p style="text-align: justify;"><strong>SSH</strong> se utiliza, principalmente, para acceder de forma segura a un servidor remoto. Además de este uso, también se utiliza muy a menudo para transferir datos entre cliente y servidor de forma segura, gestionar claves RSA que permitan el acceso al servidor sin introducir la contraseña y redirigir los datos de cualquier aplicación utilizando un túnel seguro.</p>
<p style="text-align: justify;"><strong>Documentación Ubuntu</strong></p>
<ul>
<li style="text-align: justify;"><a href="https://help.ubuntu.com/lts/serverguide/openssh-server.html" target="_blank" rel="noopener">Ubuntu Server Guide. OpenSSH.</a></li>
<li style="text-align: justify;"><a href="https://help.ubuntu.com/community/SSH/OpenSSH/Configuring" target="_blank" rel="noopener">Configuring an OpenSSH Server.</a></li>
<li style="text-align: justify;"><a href="https://help.ubuntu.com/community/SSH/OpenSSH/Keys" target="_blank" rel="noopener">SSH Key Authentication.</a></li>
</ul>
<h3>1. Escenario</h3>
<p>Para este capítulo, se trabaja con los siguiente equipos:</p>
<ul>
<li>Ubuntu server 20.04.3 que hará las veces de servidor de ssh con ip 192.168.0.22.</li>
<li>Equipo Linux Mint 19 que hará las veces de cliente con ip 192.168.0.19.</li>
<li>Equipo Windows 10 que hará las veces de cliente con ip 192.168.0.30.</li>
</ul>
<h3>2. Instalación del servidor ssh</h3>
<p style="text-align: justify;">Para instalar el servidor ssh, en primer lugar se realiza la actualización de los repositorios y luego la instalación del paquete openssh-server.<span></span></p>
<pre><span style="font-size: 12pt;"><strong>administrador@orion:/$</strong>sudo apt update &amp;&amp; sudo apt install openssh-server</span></pre>
<p style="text-align: justify;">Después de instalar el paquete <strong>openssh-server</strong> se recomienda realizar una copia de seguridad del fichero de configuración original y eliminar los permisos de escritura para todos los usuarios en la copia antes de editar la configuración para adaptarla a nuestras necesidades.</p>
<pre><span style="font-size: 12pt;"><strong>administrador@orion:/$</strong>sudo cp /etc/ssh/sshd_config sshd_config.factory-defaults<br /><strong>administrador@orion:/$</strong>sudo chmod a-w /etc/ssh/sshd_config.factory-defaults<br /></span></pre>
<p style="text-align: justify;">A continuación, hay que editar el fichero <span style="font-size: 12pt;"><strong>sshd_config</strong>:</span></p>
<pre><span style="font-size: 12pt;"><strong>administrador@orion:/$</strong>sudo nano /etc/ssh/sshd_config</span></pre>
<p>La mayoría de opciones se pueden dejar en su valor por defecto, pero algunos de los parámetros que puede resultar interesante modificar son los siguientes:</p>
<ul>
<li style="text-align: justify;"><strong>Port 22. </strong>Por defecto, SSH se asocia al puerto TCP 22. En un sistema en producción puede resultar conveniente asociarlo con otro puerto (por encima del 1024, como puede ser el 2100).</li>
<li style="text-align: justify;"><strong>LoginGraceTime 120.</strong> La opción LoginGraceTime especifica el número de segundos en que la conexión se mantiene abierta sin que se haya producido un inicio de sesión satisfactorio. Este valor se debería ajustar un a poco más del tiempo que se utiliza en realizar un inicio de sesión normal.</li>
<li style="text-align: justify;"><strong>StrictModes yes. </strong>La opción StrictModes es una guarda de protección que rechazará cualquier intento de inicio de sesión si los ficheros de autenticación son legibles por todo el mundo (es decir, cuando los ficheros de configuración no son seguros).</li>
<li style="text-align: justify;"><strong>PermitRootLogin prohibit-password.</strong> La opción PermitRootLogin especifica si el usuario root puede iniciar sesión o no de forma remota. Por defecto, no se permite acceder con contraseña aunque sí mediante otros métodos como la criptografía asimétrica o de clave pública. Si se ha creado un usuario que puede elevar sus privilegios (por medio de su o de sudo), debería tener el valor no.</li>
<li style="text-align: justify;"><strong>PasswordAuthentication yes. </strong>La opción PasswordAuthentication especifica si se permite el acceso mediante contraseña en el sistema. Si se utiliza el acceso por criptografía de clave asimétrica (claves pública y privada), este valor debería ser no.</li>
<li style="text-align: justify;"><strong>PubkeyAuthentication yes.</strong> La opción PubkeyAuthentication especifica que si se utilizará el acceso por criptografía de clave asimétrica (claves pública y privada). Por defecto, los servidores OpenSSH tienen esta opción activada.</li>
<li style="text-align: justify;"><strong>X11Forwarding yes y X11DisplayOffset 10.</strong> Estos parámetros configuran la capacidad de redireccionamiento de entorno gráfico (X11 Forwarding), lo que permite ejecutar una aplicación gráfica en el sistema remoto y visualizarla en el sistema local. Además de estar configurada en el servidor, también se debe indicar en el cliente cuando se conecte.</li>
<li style="text-align: justify;"><strong>PrintMotd no.</strong> Esta opción indica si quiere mostrar la información del motd cuando se inicie la sesión.</li>
<li style="text-align: justify;"><strong>AllowUsers ..., DenyUsers ..., AllowGroups ..., DenyGroups ....</strong> En ocasiones puede interesarte gestionar qué usuarios o qué grupos pueden o no conectarse vía SSH al servidor. Hay que tener en cuenta estos aspectos:
<ul>
<li style="text-align: justify;">Por defecto, todos los usuarios y grupos tienen acceso vía SSH, así que para cambiar esta situación es necesario configurar el servidor SSH.</li>
<li style="text-align: justify;">Opción DenyUsers: indica el nombre de uno o más usuarios que no podrán conectarse.</li>
<li style="text-align: justify;">Opción AllowUsers: indica qué usuario o lista de usuarios serán los únicos que podrán conectarse.</li>
<li style="text-align: justify;">Opción DenyGroups: indica el nombre de uno o más grupos de usuarios que no podrán conectarse.</li>
<li style="text-align: justify;">Opción AllowGropus: indica qué grupo o grupos de usuarios serán los únicos que podrán conectarse.</li>
</ul>
</li>
</ul>
<p style="text-align: justify;">Las páginas del man de este archivo dicen que, en caso de que configures más de una de estas opciones, el servidor SSH las procesará en este orden: DenyUsers, AllowUsers, DenyGroups y AllowGroups. Pero nuestras pruebas dicen que no es exactamente así, por ejemplo, si usas la opción DenyUsers, no funcionará AllowUsers. Lo mismo pasa con las directivas que afectan a los grupos.</p>
<p style="text-align: center;"><img src="fichero-conf-ssh.png" alt="" width="798" height="647" /></p>
</div>
</div>
</div>
<div id="packageLicense" class="cc cc-by-nc-sa">
<p><span>Obra publicada con</span> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Licencia Creative Commons Reconocimiento No comercial Compartir igual 4.0</a></p>
</div>
</div>
</div>
<div id='bottomPagination'>
<div class="pagination noprt">
<a href="311_aplicaciones_de_ssh.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="313_secure_shell_para_administracin_remota_mediante_certificado.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</div>
</div>
</div>
<script type="text/javascript" src="_style_js.js"></script></body></html>